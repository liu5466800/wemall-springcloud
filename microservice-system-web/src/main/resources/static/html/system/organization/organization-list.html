<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>组织机构列表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../../css/common/font.css">
    <link rel="stylesheet" href="../../../css/common/xadmin.css">
    
    <script type="text/javascript" src="../../../plugins/jquery-3.2.1/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../../../plugins/layui-2.3.0/layui.js"></script>
    <script type="text/javascript" src="../../../js/common/xadmin.js"></script>
    <script type="text/javascript" src="../../../js/common/config.js"></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body class="layui-anim layui-anim-up">
  	<div class="x-nav">
      <span class="layui-breadcrumb">
        <a href="">首页</a>
        <a href="">系统管理</a>
        <a><cite>用户列表</cite></a>
      </span>
      <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
        <i class="layui-icon" style="line-height:30px">ဂ</i></a>
    </div>
    <div class="tab-body" style="margin:5px">
      <div class="handle-box">
        <ul>
          <li class="handle-item"><span class="layui-form-label">机构名称：</span>
            <div class="layui-input-inline">
            		<input type="text" autocomplete="off" placeholder="请输入搜索条件"  name="organizationName" id="organizationName"  class="layui-input">
            	</div>
            <button class="layui-btn mgl-20" id="btn-queryorganization">查询</button>
            <span class="fr">
            <a class="layui-btn btn-add btn-default" id="btn-addorganization">
            <i class="linyer icon-add"></i>添加</a>
            <a class="layui-btn layui-btn-danger radius btn-delect" id="btn-deleteorganization">
            <i class="linyer icon-delete"></i>删除</a>
            <a class="layui-btn btn-add btn-default" id="btn-editorganization">
            <i class="linyer icon-edit"></i>编辑</a>
            <a class="layui-btn btn-show btn-default" id="btn-vieworganization">
            <i class="linyer icon-show"></i>查看</a>
            </span>
           </li>
        </ul>
      </div>
      <table class="layui-hide" id="organizationTable" lay-filter="organizationTable"></table> 
    </div>
    
    <script>
    	layui.use(['layer','form','laydate','table','carousel', 'upload', 'element'], function(){
		  var $ = layui.jquery,
		  	layer = layui.layer,
		  	form = layui.form,
		  	laydate = layui.laydate,
		  	table = layui.table,
		  	carousel = layui.carousel,
		  	upload = layui.upload,
		  	element = layui.element;
		  	table.render({
			    elem: '#organizationTable',
			    url: contextPath+'/MICROSERVICE-SYSTEM/organization/listByPage',
			    request:{
			    		pageName:'curr',
			    		limitName:'nums'
			    },
			    where: {
			    		//direction：'DESC',
			    		params: {
	    					organizationName:''
	    				} 
			    },
			    cols: [[ //标题栏
			      {checkbox: true, LAY_CHECKED: false}, //默认全选
			      {field: 'organizationName', title: '机构名称', width: '20%', sort: true},
			      {field: 'organizationCode', title: '机构编码', width: '20%', sort: true},
			      {field: 'type', title: '类型', width: '17%', sort: true},
			      {field: 'description', title: '描述', width:'40%', sort: true}
			    ]], 
			    done:function(res, curr, count){
			    	 	$("[data-field = 'type']").children().each(function(){
			    	        if($(this).text() == '0'){
			    	            $(this).text("分中心");
			    	        }else if($(this).text() == '1'){
			    	             $(this).text("机构");
			    	        }else if($(this).text() == '2'){
			    	             $(this).text("部门");
			    	        }
			    	    })
			    },
			    id: 'organizationTableId',
			    skin: 'row', //表格风格
			    even: true,
			    page: true, //是否显示分页
			    limits: [5, 10, 20,30,40],
			    limit: 10 //每页默认显示的数量
			});
		  	
		  	//查询
		  	$("#btn-queryorganization").on('click', function() {
    		    		  var organizationName = $('#organizationName');
 		    	      table.reload('organizationTableId', {
 		    	        where: {
	 		    	     params: {
		    					organizationName:organizationName.val()
		    				} 
 		    	        }
 		    	      });
    			});
		    //新增
		  	$("#btn-addorganization").on('click', function() {
    		    layer.open({
	    		    	  type: 2,
	    		    	  area: ['700px', '450px'],
	    		    	  fixed: false,
	    		    	  maxmin: true,
	    		    	  content: contextPath+'/MICROSERVICE-SYSTEM-WEB/html/system/organization/organization-add.html',
	    	          zIndex: layer.zIndex, 
	    	          success: function(layero){
	    	          	layer.setTop(layero);//加载完成后置顶
	    	          }
    		    	  });
	    		});
		    
		  	 table.on('checkbox(organizationTable)', function(){
		  			
		  	  });
		  	
		  	$("#btn-deleteorganization").on('click', function() {
		  		var checkStatus = table.checkStatus('organizationTableId');
	  			var data = checkStatus.data;
			 	if(data&&data.length>0){
			 		for(var i=0;i<data.length;i++){
			 			 var organization = {
			 					'organizationId':data[i].organizationId
			 		        };
			 			$.ajax({
				            type: "POST",
				            async: false,
				            dataType: "json",
				            data:organization,
				            url: contextPath+"/MICROSERVICE-SYSTEM/organization/delete",
				            success: function (obj) {
				            		
				            },
				            error: function(data) {
				            	 	layer.msg("delete 网络错误");
				            }
				        });
			 		}
			 		//刷新列表
			 		table.reload('organizationTableId');
			 	}else{
			 		layer.msg('请至少先选择一条数据');
			 	}
    		  	});
		  	
		  	$("#btn-editorganization").on('click', function() {
		  		var checkStatus = table.checkStatus('organizationTableId');
	  			var data = checkStatus.data;
	  			if(data&&data.length==1){
	  				    var organizationId = data[0].organizationId;
		  				layer.open({
			    		    	  type: 2,
			    		    	  area: ['700px', '450px'],
			    		    	  fixed: false,
			    		    	  maxmin: true,
			    		    	  content: contextPath+'/MICROSERVICE-SYSTEM-WEB/html/system/organization/organization-edit.html?organizationId='+organizationId,
			    	          zIndex: layer.zIndex, 
			    	          success: function(layero,index){
			    	        	  		var body = layer.getChildFrame('body', index);  //巧妙的地方在这里哦
			    	                body.contents().find("#parentCode").val(data[0].parentCode);
			    	                body.contents().find("[name='organizationName']").val(data[0].organizationName);
			    	                body.contents().find("[name='organizationCode']").val(data[0].organizationCode);
			    	                body.contents().find("#type").val(data[0].type);
			    	               // body.contents().find("input[type=radio]:checked").val(data[0].type);
			    	                body.contents().find("input[name='type'][value='"+data[0].type+"']").attr("checked",true);
			    	                body.contents().find("[name='description']").val(data[0].description);
			    	          		
			    	                layer.setTop(layero);
			    	          }
		  		    	  });
	  			}else{
			 		layer.msg('请选择一条数据');
			 	}
	  		});
		  	
		  	$("#btn-vieworganization").on('click', function() {
		  		var checkStatus = table.checkStatus('organizationTableId');
	  			var data = checkStatus.data;
	  			if(data&&data.length==1){
	  				    var organizationId = data[0].organizationId;
	  				    var parentId = data[0].parentId;
		  				layer.open({
			    		    	  type: 2,
			    		    	  area: ['700px', '450px'],
			    		    	  fixed: false,
			    		    	  maxmin: true,
			    		    	  content: contextPath+'/MICROSERVICE-SYSTEM-WEB/html/system/organization/organization-view.html?organizationId='+organizationId,
			    	          zIndex: layer.zIndex, 
			    	          success: function(layero,index){
			    	        	  		var body = layer.getChildFrame('body', index);  //巧妙的地方在这里哦
			    	                body.contents().find("#parentCode").val(data[0].parentCode);
			    	                body.contents().find("[name='organizationName']").val(data[0].organizationName);
			    	                body.contents().find("[name='organizationCode']").val(data[0].organizationCode);
			    	                body.contents().find("#type").val(data[0].type);
			    	               // body.contents().find("input[type=radio]:checked").val(data[0].type);
			    	                body.contents().find("input[name='type'][value='"+data[0].type+"']").attr("checked",true);
			    	                body.contents().find("[name='description']").val(data[0].description);
			    	          		
			    	                layer.setTop(layero);
			    	          }
		  		    	  });
	  			}else{
			 		layer.msg('请选择一条数据');
			 	}
  			});
		  	
		  	
			
		  	$("#btn-vieworganizationtest").on('click', function() {
		  		var checkStatus = table.checkStatus('organizationTableId');
	  			var data = checkStatus.data;
	  			if(data&&data.length==1){
	  				    var organizationId = data[0].organizationId;
	  				    var parentId = data[0].parentId;
		  				layer.open({
			    		    	  type: 2,
			    		    	  area: ['700px', '450px'],
			    		    	  fixed: false,
			    		    	  maxmin: true,
			    		    	  content: contextPath+'/MICROSERVICE-SYSTEM-WEB/html/system/organization/organizationviewtest.html?organizationId='+organizationId,
			    	          zIndex: layer.zIndex, 
			    	          success: function(layero,index){
			    	        	  		var body = layer.getChildFrame('body', index);  //巧妙的地方在这里哦
			    	                body.contents().find("#parentCode").val(data[0].parentCode);
			    	                body.contents().find("[name='organizationName']").val(data[0].organizationName);
			    	                body.contents().find("[name='organizationCode']").val(data[0].organizationCode);
			    	                body.contents().find("#type").val(data[0].type);
			    	               // body.contents().find("input[type=radio]:checked").val(data[0].type);
			    	                body.contents().find("input[name='type'][value='"+data[0].type+"']").attr("checked",true);
			    	                body.contents().find("[name='description']").val(data[0].description);
			    	          		
			    	                layer.setTop(layero);
			    	          }
		  		    	  });
	  			}else{
			 		layer.msg('请选择一条数据');
			 	}
  			});
		  	
   	 	});
    	
    	
	</script>
  </body>

</html>